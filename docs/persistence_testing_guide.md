# A2A Rust æŒä¹…åŒ–åŠŸèƒ½æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¦‚ä½•è¿è¡Œå’ŒéªŒè¯ a2a-rust é¡¹ç›®ä¸­æ–°å¢çš„ SQLite æŒä¹…åŒ–åŠŸèƒ½ã€‚



## ğŸ“– ç¤ºä¾‹ç¨‹åº (Examples)

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ç¨‹åºï¼Œæ¼”ç¤ºäº†å¦‚ä½•åˆå§‹åŒ–æ•°æ®åº“å¹¶ä½¿ç”¨ `TaskManager` è¿›è¡Œä»»åŠ¡æŒä¹…åŒ–ã€‚

### è¿è¡Œç¤ºä¾‹
```bash
cargo run --example sqlite_persistence_demo
```

### ç¤ºä¾‹æ¶µç›–å†…å®¹ï¼š
1. **æ•°æ®åº“è¿æ¥**ï¼šæ¼”ç¤ºå¦‚ä½•è¿æ¥åˆ° SQLiteï¼ˆç¤ºä¾‹ä¸­ä½¿ç”¨ `:memory:` æ¨¡å¼ï¼‰ã€‚
2. **è¡¨ç»“æ„åˆå§‹åŒ–**ï¼šè‡ªåŠ¨åˆ›å»º `tasks` è¡¨ã€‚
3. **ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ**ï¼š
   - åˆ›å»ºæ–°ä»»åŠ¡ã€‚
   - é€šè¿‡ `TaskManager` æ›´æ–°ä»»åŠ¡çš„æ¶ˆæ¯å†å²ã€‚
   - å°†ä»»åŠ¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ã€‚
   - ä»æ•°æ®åº“æŒ‰ ID æ£€ç´¢ä»»åŠ¡å¹¶éªŒè¯çŠ¶æ€ã€‚
   - åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰ä»»åŠ¡ã€‚

---

## ğŸ§ª é›†æˆæµ‹è¯• (Integration Tests)

æ–°å¢çš„é›†æˆæµ‹è¯•æ–‡ä»¶ `tests/persistence_integration_test.rs` è¦†ç›–äº†æ›´å¤æ‚çš„æŒä¹…åŒ–åœºæ™¯ã€‚

### è¿è¡Œé›†æˆæµ‹è¯•
```bash
cargo test --test persistence_integration_test
```

### æµ‹è¯•ç”¨ä¾‹è¯´æ˜ï¼š
- **`test_full_persistence_lifecycle`**: éªŒè¯å¤šä»»åŠ¡å¹¶å‘ä¿å­˜ã€è¯»å–ã€çŠ¶æ€æ›´æ–°ä»¥åŠåˆ é™¤æ“ä½œçš„æ­£ç¡®æ€§ã€‚
- **`test_encrypted_push_config_persistence`**: éªŒè¯æ¨é€é€šçŸ¥é…ç½®çš„**åŠ å¯†å­˜å‚¨**ã€‚å®ƒä¼šæ£€æŸ¥æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ Tokenï¼‰æ˜¯å¦èƒ½è¢«æ­£ç¡®åŠ å¯†å†™å…¥å¹¶è§£å¯†è¯»å‡ºã€‚

---

## å•å…ƒæµ‹è¯• (Unit Tests)

æ‚¨ä¹Ÿå¯ä»¥è¿è¡Œå†…ç½®åœ¨æºç ä¸­çš„ SQL å­˜å‚¨å•å…ƒæµ‹è¯•ï¼š

```bash
# è¿è¡Œä»»åŠ¡å­˜å‚¨å•å…ƒæµ‹è¯•
cargo test sql_task_store

# è¿è¡Œæ¨é€é…ç½®å­˜å‚¨å•å…ƒæµ‹è¯•
cargo test sql_push_notification_config_store
```

---

## ğŸ“‚ ç›¸å…³æ–‡ä»¶
- **ç¤ºä¾‹ä»£ç **: `examples/sqlite_persistence_demo.rs`
- **é›†æˆæµ‹è¯•**: `tests/persistence_integration_test.rs`
- **æ ¸å¿ƒå®ç°**: 
  - `src/a2a/server/tasks/sql_task_store.rs`
  - `src/a2a/server/tasks/sql_push_notification_config_store.rs`
